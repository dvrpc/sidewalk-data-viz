(()=>{"use strict";mapboxgl.accessToken="pk.eyJ1IjoibW1vbHRhIiwiYSI6ImNqZDBkMDZhYjJ6YzczNHJ4cno5eTcydnMifQ.RJNJ7s7hBfrJITOBZBdcOA";const e=()=>{const e=(()=>{const e=window.innerWidth<=420?7.3:8.65;return new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/dark-v10",center:[-75.15913247977207,40.02727228000965],zoom:e})})();var t=new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl,marker:!0,placeholder:"Type here to zoom to...",bbox:[-76.210785,39.478606,-73.885803,40.601963]});e.addControl(t,"top-left");const i=(e=>{const t={center:[-75.15913247977207,40.02727228000965],zoom:window.innerWidth<=420?7.3:8.65},i=new mapboxgl.NavigationControl,o=document.createElement("button"),s=document.createElement("img");return o.type="button",s.id="regional-extent-img",s.alt="DVRPC Alternative Logo",s.src="https://www.dvrpc.org/img/banner/new/bug-favicon.png",o.classList.add("mapboxgl-ctrl-icon"),o.classList.add("mapboxgl-ctrl-dvrpc"),o.setAttribute("aria-label","Default DVRPC Extent"),o.onclick=()=>e.flyTo({center:t.center,zoom:t.zoom}),o.appendChild(s),i._extent=o,i._container.appendChild(o),i})(e);return e.addControl(i,"bottom-right"),e},t={boundaries:{type:"vector",url:"https://tiles.dvrpc.org/data/dvrpc-municipal.json"},sidewalk_inventory:{type:"vector",url:"https://tiles.dvrpc.org/data/pedestrian-network.json"},ped_analysis:{type:"vector",url:"https://tiles.dvrpc.org/data/sidewalk-gaps-analysis-v2.json"},regional_boundaries:{type:"vector",url:"https://tiles.dvrpc.org/data/dvrpc-municipal.json"}};var i=["all",["==","schema","rs_sw"]],o=["all",["==","schema","rs_osm"]];const s={countyOutline:{id:"county-outline",type:"line",source:"boundaries","source-layer":"county",paint:{"line-width":2.5,"line-color":"#6cd0ff"},filter:["==","dvrpc","Yes"]},muniOutline:{id:"municipality-outline",type:"line",source:"boundaries","source-layer":"municipalities",paint:{"line-width":.5,"line-color":"#6cd0ff"}},iso_osm:{id:"iso_osm",type:"fill",source:"ped_analysis","source-layer":"ridescore_isos",paint:{"fill-color":"rgba(255, 255, 255, 0.5)","fill-opacity":0},filter:o,layout:{visibility:"none"}},iso_sw:{id:"iso_sw",type:"fill",source:"ped_analysis","source-layer":"ridescore_isos",paint:{"fill-color":"rgba(0, 255, 0, 0.5)","fill-opacity":0},filter:i,layout:{visibility:"none"}},sidewalks:{id:"sidewalks",type:"line",source:"sidewalk_inventory",layout:{visibility:"visible"},paint:{"line-width":1.2,"line-color":"rgba(255,255,255,0.5)"},"source-layer":"ped_lines",filter:["==","line_type",1]},crosswalks:{id:"crosswalks",type:"line",source:"sidewalk_inventory",layout:{visibility:"visible"},minzoom:13,paint:{"line-width":4,"line-color":"rgba(255,255,255,0.5)"},"source-layer":"ped_lines",filter:["==","line_type",2]},centerlines:{id:"centerlines",type:"line",source:"ped_analysis","source-layer":"osm_sw_coverage",minzoom:7,paint:{"line-width":4,"line-color":["case",["<",["get","sw_ratio"],.45],"rgba(215,25,28,0.7)",["<=",["get","sw_ratio"],.82],"rgba(255, 140, 62,0.7)","rgba(26,150,65,0.3)"]},layout:{visibility:"visible"}},sw_nodes:{id:"sw_nodes",type:"circle",source:"ped_analysis","source-layer":"sw_nodes",minzoom:7,paint:{"circle-radius":4,"circle-color":{property:"walk_time",stops:[[0,"rgba(26,152,80,0.7)"],[5,"rgba(145,207,96,0.7)"],[10,"rgba(217,239,139,0.7)"],[30,"rgba(255,255,191,0.7)"],[60,"rgba(254,224,139,0.7)"],[179,"rgba(252,141,89,0.7)"],[180,"rgba(215,48,39,0.7)"]]}},layout:{visibility:"none"}},ridescore_pois_all:{id:"ridescore_pois_all",type:"circle",source:"ped_analysis","source-layer":"ridescore_pois",minzoom:12,paint:{"circle-radius":4,"circle-stroke-color":"white","circle-stroke-width":1.5,"circle-color":"rgba(0,0,0,1)","circle-opacity":0,"circle-stroke-opacity":0},layout:{visibility:"none"}},stations:{id:"stations",type:"circle",source:"ped_analysis","source-layer":"sidewalkscore",minzoom:7,paint:{"circle-radius":12,"circle-stroke-color":"white","circle-stroke-width":1.5,"circle-color":{property:"sidewalkscore",default:"black",stops:[[0,"rgba(255, 0, 0, 1)"],[.7,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"],[2,"rgba(0, 153, 0, 1)"]]}},layout:{visibility:"none"}},station_selected:{id:"station_selected",type:"circle",source:"ped_analysis","source-layer":"sidewalkscore",minzoom:7,paint:{"circle-radius":20,"circle-stroke-color":"black","circle-stroke-width":4,"circle-color":{property:"sidewalkscore",default:"black",stops:[[0,"rgba(255, 0, 0, 1)"],[.7,"rgba(255, 255, 0, 1)"],[1,"rgba(0, 153, 0, 1)"],[2,"rgba(0, 153, 0, 1)"]]},"circle-opacity":0,"circle-stroke-opacity":0},layout:{visibility:"none"}},islands:{id:"islands",type:"line",source:"ped_analysis",layout:{visibility:"none"},"source-layer":"islands",paint:{"line-color":["get","rgba"]}},transit_stops:{id:"transit_stops",type:"circle",source:"ped_analysis","source-layer":"transit_stops",minzoom:12,paint:{"circle-radius":6,"circle-stroke-color":"white","circle-stroke-width":1.5,"circle-color":"rgba(0,0,0,0)"},layout:{visibility:"none"}}},a={sidewalks:{id:"sidewalks",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.1,17,.8]},crosswalks:{id:"crosswalks",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],15,2,18,12]},centerlines:{id:"centerlines",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],8.5,.1,15,4,22,22]},sw_nodes:{id:"sw_nodes",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],12,1.5,18,12]},transit_stops:{id:"transit_stops",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],12,1.5,18,12]},stations:{id:"stations",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],12,5,18,20]},station_selected:{id:"station_selected",attribute:"circle-radius",style:["interpolate",["linear"],["zoom"],12,9,18,30]},islands:{id:"islands",attribute:"line-width",style:["interpolate",["exponential",.5],["zoom"],10,.75,17,2]}},r=e=>{e.style.display="none",e.setAttribute("aria-hidden","true")},l={"gap-analysis":{layer_ids:["centerlines"],layer_names:["Sidewalk Coverage"],image_path:"img/Webmap-Legend-v2-segment-map.png",alt_text:"Legend showing sidewalk coverage",methodology_title:"Street Segment Gap Methodology"},"transit-analysis":{layer_ids:["transit_stops","sw_nodes"],layer_names:["Transit Stops (SEPTA, NJ TRANSIT, & PATCO)","Walk Time to Nearest Transit Stop"],image_path:"img/Webmap-Legend-v2-network-map.png",alt_text:"Legend showing walk time to nearest transit stop",methodology_title:"Walk Time to Transit Methodology"},"rail-walksheds":{layer_ids:["ridescore_pois_all","station_selected","stations","iso_osm","iso_sw"],layer_names:["[Selected] Rail Station Access Point","[Selected] Rail Station Sidewalk Score","Rail Station Sidewalk Score","Street Centerline Walkshed (1-mile)","Sidewalk Walkshed (1-mile)"],image_path:"img/Webmap-Legend-v2-rail-map.png",alt_text:"Legend showing sidewalk and centerline walksheds around rail stations",methodology_title:"Rail Station Walksheds Methodology"},"island-analysis":{layer_ids:["islands"],layer_names:["Islands of Connectivity"],image_path:"img/Webmap-Legend-v2-island-map.png",alt_text:"Legend for distinct islands",methodology_title:"Islands of Connectivity Methodology"}},n=Object.keys(l);function c(e,t){var i=document.getElementById("toggler");i&&i.remove();for(var o=0;o<e.length;o++){var s=e[o];t.setLayoutProperty(s,"visibility","none")}}function d(e,t){p();for(var i=n.filter((function(t){return t!==e})),o=0;o<i.length;o++){var s=i[o];c(l[s].layer_ids,t),document.getElementById(s).classList.remove("active");var a=s+"-description";(r=document.getElementById(a))&&r.classList.add("hidden-text")}var r;!function(e,t,i){var o=document.getElementById("analysis-toggler"),s=document.createElement("ul");s.setAttribute("id","toggler");for(var a=0;a<e.length;a++){var r=e[a],l=t[a];if(!document.getElementById(r)){var n=document.createElement("li"),c=document.createElement("label");c.innerText=l;var d=document.createElement("input");d.id=r,d.value=r,d.type="checkbox",d.name="layer",d.checked=!0,d.label="&nbsp;"+l,c.prepend(d),n.appendChild(c),s.prepend(n)}i.setLayoutProperty(r,"visibility","visible")}o.appendChild(s)}(l[e].layer_ids,l[e].layer_names,t),document.getElementById("legend-image").setAttribute("src",l[e].image_path),document.getElementById("legend-image").setAttribute("alt",l[e].alt_text),document.getElementById("methodology-title").innerText=l[e].methodology_title,document.getElementById(e).classList.add("active"),(r=document.getElementById(e+"-description")).classList.remove("hidden-text")}const p=()=>{var e=document.getElementsByClassName("i-am-a-popup");e.length&&e[0].remove()},y=(e,t,i)=>{new mapboxgl.Popup({closebutton:!1,className:"i-am-a-popup"}).setLngLat(i.lngLat).setHTML(t).addTo(e)},m={centerlines:e=>{var t=100*e.features[0].properties.sw_ratio;if(t>100&&(t=100),100==t)var i="100%";else if(0==t)i="No";else i=String(t.toFixed(1))+"%";return"<h1>"+i+"</h1><p>sidewalk coverage</p>"},sw_nodes:e=>{var t=e.features[0].properties;return t.walk_time<180?"<h1>"+t.walk_time.toFixed(1)+" minutes</h1><p>to the nearest transit stop by foot</p>":"<h1>ðŸš·</h1><p>No transit stops are accessible solely via the sidewalk network</p>"},stations:e=>{var t=e.features[0].properties;return null==t.sidewalkscore?"<h1>"+t.operator+" : "+t.station+"</h1><p>No sidewalk score was calculated since the point did not snap to either the OSM or sidewalk networks</p>":0==t.sidewalkscore?"<h1>"+t.operator+" : "+t.station+"</h1><p>This point did not snap to the sidewalk network</p>":"<h1>"+t.operator+" : "+t.station+"</h1><p>Sidewalk score: "+t.sidewalkscore.toFixed(3)+"</p>"},transit_stops:e=>{var t=e.features[0].properties;return"<h1>"+t.src+"</h1><p>"+t.stop_name+"</p>"},islands:e=>{var t=e.features[0].properties;if(1==t.muni_count)var i=" is entirely within <strong>"+t.muni_names.split(":")[0]+"</strong>";else{i=" intersects <strong>"+t.muni_count+" municipalities </strong>: <ul>";t.muni_names.split(",").slice(0,-1).forEach((function(e,t){i+="<li>"+e+"%</li>"})),i+="</ul>"}return"This island is <strong>"+t.size_miles.toFixed(1)+"</strong> linear miles long, and "+i}},u=Object.keys(m),g=document.getElementById("modal"),_=document.getElementById("modal-toggle"),b=document.getElementById("close-modal"),h=Array.from(document.querySelectorAll(".sidebar-form-toggle")),v=e();v.on("load",(()=>{for(var e,r=v.getStyle().layers,l=0;l<r.length;l++)if("symbol"===r[l].type){e=r[l].id;break}for(const e in t)v.addSource(e,t[e]);for(const t in s)v.addLayer(s[t],e);for(const e in a)v.setPaintProperty(a[e].id,a[e].attribute,a[e].style);h.forEach((e=>((e,t)=>{e.onchange=e=>{const i=e.target.value,o=e.target.checked?"visible":"none";t.setLayoutProperty(i,"visibility",o)}})(e,v)));for(l=0;l<u.length;l++){let e=u[l];v.on("mouseenter",e,(()=>v.getCanvas().style.cursor="pointer")),v.on("click",e,(function(t){p();var i=m[e](t);y(v,i,t)})),v.on("mouseleave",e,(function(e){v.getCanvas().style.cursor=""}))}(e=>{e.on("click","stations",(function(t){var s=t.features[0].properties,a=["in","dvrpc_id",s.dvrpc_id.toString()];e.setFilter("iso_sw",["all",a,i]),e.setPaintProperty("iso_sw","fill-opacity",.7),e.setFilter("iso_osm",["all",a,o]),e.setPaintProperty("iso_osm","fill-opacity",.7),e.setFilter("station_selected",["in","dvrpc_id",s.dvrpc_id]),e.setPaintProperty("station_selected","circle-opacity",1),e.setPaintProperty("station_selected","circle-stroke-opacity",1),e.setFilter("ridescore_pois_all",["in","dvrpc_id",s.dvrpc_id]),e.setPaintProperty("ridescore_pois_all","circle-opacity",1),e.setPaintProperty("ridescore_pois_all","circle-stroke-opacity",1),e.flyTo({center:t.lngLat,zoom:13,essential:!0})}))})(v)}));for(let e=0;e<n.length;e++){let t=n[e];document.getElementById(t).onclick=function(){d(t,v)}}_.onclick=()=>(e=>{e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.setAttribute("aria-hidden","false")})(g),b.onclick=()=>r(g),g.onclick=e=>{e.target==g&&r(g)},document.onkeydown=e=>{"Escape"===e.code&&"flex"===g.style.display&&r(g)}})();